(function(t,_){typeof exports=="object"&&typeof module<"u"?_(exports):typeof define=="function"&&define.amd?define(["exports"],_):(t=typeof globalThis<"u"?globalThis:t||self,_(t.RefactChat={}))})(this,function(t){"use strict";/*! js-cookie v3.0.5 | MIT */function _(e){for(var r=1;r<arguments.length;r++){var f=arguments[r];for(var a in f)e[a]=f[a]}return e}var Y={read:function(e){return e[0]==='"'&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function g(e,r){function f(i,u,n){if(!(typeof document>"u")){n=_({},r,n),typeof n.expires=="number"&&(n.expires=new Date(Date.now()+n.expires*864e5)),n.expires&&(n.expires=n.expires.toUTCString()),i=encodeURIComponent(i).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var o="";for(var c in n)n[c]&&(o+="; "+c,n[c]!==!0&&(o+="="+n[c].split(";")[0]));return document.cookie=i+"="+e.write(u,i)+o}}function a(i){if(!(typeof document>"u"||arguments.length&&!i)){for(var u=document.cookie?document.cookie.split("; "):[],n={},o=0;o<u.length;o++){var c=u[o].split("="),A=c.slice(1).join("=");try{var d=decodeURIComponent(c[0]);if(n[d]=e.read(A,d),i===d)break}catch{}}return i?n[i]:n}}return Object.create({set:f,get:a,remove:function(i,u){f(i,"",_({},u,{expires:-1}))},withAttributes:function(i){return g(this.converter,_({},this.attributes,i))},withConverter:function(i){return g(_({},this.converter,i),this.attributes)}},{attributes:{value:Object.freeze(r)},converter:{value:Object.freeze(e)}})}var W=g(Y,{path:"/"});const F=()=>W.get("api_key")??"",L="/v1/chat",T="/v1/caps",O="/v1/get-dashboard-plots",q="/v1/at-command-completion",U="/v1/at-command-preview",j="/v1/customization";function z(e){return e[0]==="user"}function J(e){return e[0]==="context_file"}function X(e){return!e||typeof e!="object"||!("id"in e)||!("content"in e)||!("role"in e)?!1:e.role==="user"||e.role==="context_file"}function Z(e,r,f,a){const i=e.map(([A,d])=>{const K=typeof d=="string"?d:JSON.stringify(d);return{role:A,content:K}}),u=JSON.stringify({messages:i,model:r,parameters:{max_new_tokens:1e3},stream:!0}),n=F(),o={"Content-Type":"application/json",...n?{Authorization:"Bearer "+n}:{}},c=a?`${a.replace(/\/*$/,"")}${L}`:L;return fetch(c,{method:"POST",headers:o,body:u,redirect:"follow",cache:"no-cache",referrer:"no-referrer",signal:f.signal,credentials:"same-origin"})}async function H(e){const r=e?`${e.replace(/\/*$/,"")}${T}`:T,f=await fetch(r,{method:"GET",credentials:"same-origin",headers:{accept:"application/json"}});if(!f.ok)throw new Error(f.statusText);const a=await f.json();if(!C(a))throw new Error("Invalid response from caps");return a}function M(e){return!e||typeof e!="object"||!("data"in e)?!1:typeof e.data=="string"}async function V(e){const r=e?`${e.replace(/\/*$/,"")}${O}`:O,f=await fetch(r,{method:"GET",credentials:"same-origin",headers:{accept:"application/json"}});if(!f.ok)throw new Error(f.statusText);const a=await f.json();if(!M(a))throw new Error("Invalid response for statistic data");return a}function C(e){return!(!e||typeof e!="object"||!("code_chat_default_model"in e)||typeof e.code_chat_default_model!="string"||!("code_chat_models"in e))}function k(e){return!(!e||typeof e!="object"||!("completions"in e)||!("replace"in e)||!("is_cmd_executable"in e))}function h(e){return!(!e||typeof e!="object"||!("detail"in e))}async function N(e,r,f,a){const i=a?`${a.replace(/\/*$/,"")}${q}`:q,u=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:e,cursor:r,top_n:f})});if(!u.ok)throw new Error(u.statusText);const n=await u.json();if(!k(n)&&!h(n))throw new Error("Invalid response from completion");return h(n)?{completions:[],replace:[0,0],is_cmd_executable:!1}:n}function B(e){if(!e||typeof e!="object"||!("messages"in e)||!Array.isArray(e.messages))return!1;if(!e.messages.length)return!0;const r=e.messages[0];return!(!r||typeof r!="object"||!("role"in r)||r.role!=="context_file"||!("content"in r)||typeof r.content!="string")}async function x(e,r){const f=r?`${r.replace(/\/*$/,"")}${U}`:U,a=await fetch(f,{method:"POST",headers:{"Content-Type":"application/json"},redirect:"follow",cache:"no-cache",referrer:"no-referrer",credentials:"same-origin",body:JSON.stringify({query:e})});if(!a.ok)throw new Error(a.statusText);const i=await a.json();if(!B(i)&&!h(i))throw new Error("Invalid response from command preview");return h(i)?[]:i.messages.map(({role:n,content:o})=>{const c=JSON.parse(o);return[n,c]})}function ee(e){return!(!e||typeof e!="object"||!("text"in e)||!("description"in e))}function v(e){if(!e||typeof e!="object")return!1;for(const r of Object.values(e))if(!ee(r))return!1;return!0}function $(e){return!e||typeof e!="object"||!("system_prompts"in e)||typeof e.system_prompts!="object"||e.system_prompts===null?!1:v(e.system_prompts)}async function te(e){const r=e?`${e.replace(/\/*$/,"")}${j}`:j,f=F(),a=await fetch(r,{method:"GET",credentials:"same-origin",redirect:"follow",cache:"no-cache",referrer:"no-referrer",headers:{accept:"application/json",...f?{Authorization:"Bearer "+f}:{}}});if(!a.ok)throw new Error(a.statusText);const i=await a.json();return $(i)?i.system_prompts:{}}var R=(e=>(e.SAVE_CHAT="save_chat_to_history",e.ASK_QUESTION="chat_question",e.REQUEST_CAPS="chat_request_caps",e.STOP_STREAMING="chat_stop_streaming",e.BACK_FROM_CHAT="chat_back_from_chat",e.OPEN_IN_CHAT_IN_TAB="open_chat_in_new_tab",e.SEND_TO_SIDE_BAR="chat_send_to_sidebar",e.READY="chat_ready",e.NEW_FILE="chat_create_new_file",e.PASTE_DIFF="chat_paste_diff",e.REQUEST_AT_COMMAND_COMPLETION="chat_request_at_command_completion",e.REQUEST_PREVIEW_FILES="chat_request_preview_files",e.REQUEST_PROMPTS="chat_request_prompts",e))(R||{}),S=(e=>(e.CLEAR_ERROR="chat_clear_error",e.RESTORE_CHAT="restore_chat_from_history",e.CHAT_RESPONSE="chat_response",e.BACKUP_MESSAGES="back_up_messages",e.DONE_STREAMING="chat_done_streaming",e.ERROR_STREAMING="chat_error_streaming",e.NEW_CHAT="create_new_chat",e.RECEIVE_CAPS="receive_caps",e.RECEIVE_CAPS_ERROR="receive_caps_error",e.SET_CHAT_MODEL="chat_set_chat_model",e.SET_DISABLE_CHAT="set_disable_chat",e.ACTIVE_FILE_INFO="chat_active_file_info",e.TOGGLE_ACTIVE_FILE="chat_toggle_active_file",e.RECEIVE_AT_COMMAND_COMPLETION="chat_receive_at_command_completion",e.RECEIVE_AT_COMMAND_PREVIEW="chat_receive_at_command_preview",e.SET_SELECTED_AT_COMMAND="chat_set_selected_command",e.SET_LAST_MODEL_USED="chat_set_last_model_used",e.SET_SELECTED_SNIPPET="chat_set_selected_snippet",e.REMOVE_PREVIEW_FILE_BY_NAME="chat_remove_file_from_preview",e.SET_PREVIOUS_MESSAGES_LENGTH="chat_set_previous_messages_length",e.RECEIVE_TOKEN_COUNT="chat_set_tokens",e.RECEIVE_PROMPTS="chat_receive_prompts",e.RECEIVE_PROMPTS_ERROR="chat_receive_prompts_error",e.SET_SELECTED_SYSTEM_PROMPT="chat_set_selected_system_prompt",e))(S||{});function re(e){return l(e)?e.type==="chat_ready":!1}function l(e){if(!e||typeof e!="object"||!("type"in e)||typeof e.type!="string")return!1;const r={...R};return Object.values(r).includes(e.type)}function ie(e){return l(e)?e.type==="chat_request_prompts":!1}function se(e){return l(e)?e.type==="chat_request_at_command_completion":!1}function ne(e){return l(e)?e.type==="chat_request_preview_files":!1}function ae(e){return l(e)?e.type==="chat_create_new_file":!1}function fe(e){return l(e)?e.type==="chat_paste_diff":!1}function ue(e){return b(e)?e.type==="chat_question":!1}function oe(e){return b(e)?e.type==="save_chat_to_history":!1}function ce(e){return l(e)?e.type==="chat_request_caps":!1}function le(e){return l(e)?e.type==="chat_stop_streaming":!1}function s(e){if(!e||typeof e!="object"||!("type"in e)||typeof e.type!="string")return!1;const r={...S};return Object.values(r).includes(e.type)}function _e(e){return s(e)?e.type==="chat_set_selected_system_prompt":!1}function pe(e){return!s(e)||e.type!=="chat_receive_prompts"||!("payload"in e)||typeof e.payload!="object"||!("prompts"in e.payload)?!1:v(e.payload.prompts)}function de(e){return!(!s(e)||e.type!=="chat_receive_prompts_error"||!("payload"in e)||typeof e.payload!="object"||!("id"in e.payload)||typeof e.payload.id!="string"||!("error"in e.payload)||typeof e.payload.error!="string")}function me(e){return s(e)?e.type==="chat_receive_at_command_completion":!1}function ye(e){return s(e)?e.type==="chat_receive_at_command_preview":!1}function he(e){return s(e)?e.type==="chat_set_selected_command":!1}function ge(e){return s(e)?e.type==="chat_toggle_active_file":!1}function Ce(e){return s(e)?e.type==="chat_active_file_info":!1}function ve(e){return s(e)?e.type==="set_disable_chat":!1}function Re(e){return s(e)?e.type==="chat_set_chat_model":!1}function Se(e){return s(e)?e.type==="chat_response":!1}function be(e){return s(e)?e.type==="back_up_messages":!1}function Ie(e){return s(e)?e.type==="restore_chat_from_history":!1}function De(e){return s(e)?e.type==="create_new_chat":!1}function Ee(e){return s(e)?e.type==="chat_done_streaming":!1}function we(e){return!(!s(e)||e.type!=="chat_error_streaming"||!("payload"in e)||typeof e.payload!="object"||!("id"in e.payload)||typeof e.payload.id!="string"||!("message"in e.payload)||typeof e.payload.message!="string")}function Pe(e){return s(e)?e.type==="chat_clear_error":!1}function Ae(e){return!s(e)||!("payload"in e)||typeof e.payload!="object"||!("caps"in e.payload)||!C(e.payload.caps)?!1:e.type==="receive_caps"}function Fe(e){return s(e)?e.type==="receive_caps_error":!1}function b(e){return l(e)||s(e)}function Le(e){return s(e)?e.type==="chat_set_last_model_used":!1}function Te(e){return s(e)?e.type==="chat_set_selected_snippet":!1}function Oe(e){return s(e)&&e.type==="chat_remove_file_from_preview"}function qe(e){return s(e)?e.type==="chat_set_previous_messages_length":!1}function Ue(e){return s(e)?e.type==="chat_set_tokens":!1}var I=(e=>(e.RECEIVE_CHAT_HISTORY="sidebar_receive_chat_history",e))(I||{});function G(e){if(!e||typeof e!="object"||!("type"in e)||typeof e.type!="string")return!1;const r={...I};return Object.values(r).includes(e.type)}function je(e){return G(e)?e.type==="sidebar_receive_chat_history":!1}var D=(e=>(e.READY="sidebar_ready",e.OPEN_CHAT_IN_SIDEBAR="sidebar_open_chat_in_sidebar",e.OPEN_IN_CHAT_IN_TAB="sidebar_open_chat_in_tab",e.DELETE_HISTORY_ITEM="sidebar_delete_history_item",e.REQUEST_CHAT_HISTORY="sidebar_request_chat_history",e))(D||{});function m(e){if(!e||typeof e!="object"||!("type"in e)||typeof e.type!="string")return!1;const r={...D};return Object.values(r).includes(e.type)}function Me(e){return m(e)?e.type==="sidebar_ready":!1}function ke(e){return m(e)&&e.type==="sidebar_open_chat_in_sidebar"}function Be(e){return m(e)?e.type==="sidebar_open_chat_in_tab":!1}function $e(e){return m(e)?e.type==="sidebar_delete_history_item":!1}function Ge(e){return m(e)?e.type==="sidebar_request_chat_history":!1}var E=(e=>(e.BACK_FROM_STATISTIC="back_from_statistic",e))(E||{}),w=(e=>(e.REQUEST_STATISTIC_DATA="request_statistic_data",e.RECEIVE_STATISTIC_DATA="receive_statistic_data",e.RECEIVE_STATISTIC_DATA_ERROR="receive_statistic_data_error",e.SET_LOADING_STATISTIC_DATA="set_loading_statistic_data",e.SET_STATISTIC_DATA="set_statistic_data",e))(w||{});function Qe(e){if(!e||typeof e!="object"||!("type"in e)||typeof e.type!="string")return!1;const r={...E};return Object.values(r).includes(e.type)}function y(e){if(!e||typeof e!="object"||!("type"in e)||typeof e.type!="string")return!1;const r={...w};return Object.values(r).includes(e.type)}function Ke(e){return y(e)?e.type==="request_statistic_data":!1}function Ye(e){return!(!y(e)||e.type!=="receive_statistic_data"||!("payload"in e)||!e.payload||typeof e.payload!="object"||!("data"in e.payload)||typeof e.payload.data!="string")}function We(e){return y(e)?e.type==="receive_statistic_data_error":!1}function ze(e){return y(e)?e.type==="set_statistic_data":!1}function Je(e){return y(e)?e.type==="set_loading_statistic_data":!1}var Q=(e=>(e.UPDATE="receive_config_update",e))(Q||{});function Xe(e){return!(!e||typeof e!="object"||!("type"in e)||e.type!=="receive_config_update"||!("payload"in e)||typeof e.payload!="object")}var P=(e=>(e.DATA_REQUEST="fim_debug_data_request",e.DATA_RECEIVE="fim_debug_data_receive",e.DATA_ERROR="fim_debug_data_error",e.READY="fim_debug_ready",e.CLEAR_ERROR="fim_debug_clear_error",e.BACK="fim_debug_back",e))(P||{});const Ze=Object.values(P);function p(e){return!e||typeof e!="object"||!("type"in e)||typeof e.type!="string"?!1:Ze.includes(e.type)}function He(e){return p(e)?e.type==="fim_debug_ready":!1}function Ve(e){return p(e)?e.type==="fim_debug_data_request":!1}function Ne(e){return p(e)?e.type==="fim_debug_clear_error":!1}function xe(e){return p(e)?e.type==="fim_debug_data_receive":!1}function et(e){return!p(e)||e.type!=="fim_debug_data_error"||!("payload"in e)||typeof e.payload!="object"||e.payload===null||!("message"in e.payload)?!1:typeof e.payload.message=="string"}function tt(e){return p(e)?e.type==="fim_debug_back":!1}t.EVENT_NAMES_FROM_CHAT=R,t.EVENT_NAMES_FROM_SIDE_BAR=D,t.EVENT_NAMES_FROM_STATISTIC=E,t.EVENT_NAMES_TO_CHAT=S,t.EVENT_NAMES_TO_CONFIG=Q,t.EVENT_NAMES_TO_SIDE_BAR=I,t.EVENT_NAMES_TO_STATISTIC=w,t.FIM_EVENT_NAMES=P,t.getAtCommandCompletion=N,t.getAtCommandPreview=x,t.getCaps=H,t.getPrompts=te,t.getStatisticData=V,t.isAction=b,t.isActionFromChat=l,t.isActionFromSidebar=m,t.isActionFromStatistic=Qe,t.isActionToChat=s,t.isActionToSideBar=G,t.isActionToStatistic=y,t.isActiveFileInfo=Ce,t.isBackFromFIMDebug=tt,t.isBackupMessages=be,t.isCapsResponse=C,t.isChatClearError=Pe,t.isChatContextFileMessage=J,t.isChatDoneStreaming=Ee,t.isChatErrorStreaming=we,t.isChatReceiveCaps=Ae,t.isChatReceiveCapsError=Fe,t.isChatSetLastModelUsed=Le,t.isChatUserMessageResponse=X,t.isClearFIMDebugError=Ne,t.isCommandCompletionResponse=k,t.isCommandPreviewResponse=B,t.isCreateNewChat=De,t.isCustomPromptsResponse=$,t.isDeleteChatHistory=$e,t.isDetailMessage=h,t.isFIMAction=p,t.isNewFileFromChat=ae,t.isOpenChatInSidebar=ke,t.isOpenChatInTab=Be,t.isPasteDiffFromChat=fe,t.isQuestionFromChat=ue,t.isReadyMessage=re,t.isReadyMessageFromFIMDebug=He,t.isReceiveAtCommandCompletion=me,t.isReceiveAtCommandPreview=ye,t.isReceiveChatHistory=je,t.isReceiveDataForStatistic=Ye,t.isReceiveDataForStatisticError=We,t.isReceiveFIMDebugData=xe,t.isReceiveFIMDebugError=et,t.isReceivePrompts=pe,t.isReceivePromptsError=de,t.isReceiveTokenCount=Ue,t.isRemovePreviewFileByName=Oe,t.isRequestAtCommandCompletion=se,t.isRequestCapsFromChat=ce,t.isRequestChatHistory=Ge,t.isRequestDataForStatistic=Ke,t.isRequestFIMData=Ve,t.isRequestPreviewFiles=ne,t.isRequestPrompts=ie,t.isResponseToChat=Se,t.isRestoreChat=Ie,t.isSaveChatFromChat=oe,t.isSetChatModel=Re,t.isSetDisableChat=ve,t.isSetLoadingStatisticData=Je,t.isSetPreviousMessagesLength=qe,t.isSetSelectedAtCommand=he,t.isSetSelectedSnippet=Te,t.isSetSelectedSystemPrompt=_e,t.isSetStatisticData=ze,t.isSidebarReady=Me,t.isStatisticDataResponse=M,t.isStopStreamingFromChat=le,t.isSystemPrompts=v,t.isToggleActiveFile=ge,t.isUpdateConfigMessage=Xe,t.isUserMessage=z,t.sendChat=Z,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});
